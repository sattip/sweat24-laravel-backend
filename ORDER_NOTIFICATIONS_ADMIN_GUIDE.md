# 📱 **ΟΔΗΓΟΣ ΕΙΔΟΠΟΙΗΣΕΩΝ ΠΑΡΑΓΓΕΛΙΩΝ - ADMIN PANEL**

## 🎯 **ΠΕΡΙΓΡΑΦΗ**
Όταν το Admin Panel ενημερώνει την κατάσταση μιας παραγγελίας, **αυτόματα στέλνεται push notification στον πελάτη** που έκανε την παραγγελία.

---

## 🔄 **ΚΑΤΑΣΤΑΣΕΙΣ ΠΑΡΑΓΓΕΛΙΩΝ & ΕΙΔΟΠΟΙΗΣΕΙΣ**

| **Κατάσταση** | **Status Code** | **Ειδοποίηση** | **Προτεραιότητα** |
|---------------|----------------|----------------|------------------|
| **Εκκρεμής** | `pending` | ❌ Χωρίς ειδοποίηση | - |
| **Σε Επεξεργασία** | `processing` | ✅ "Παραγγελία σε Επεξεργασία! 🔄" | Medium |
| **Έτοιμη για Παραλαβή** | `ready_for_pickup` | ✅ "Παραγγελία Έτοιμη για Παραλαβή! 📦" | **High** |
| **Ολοκληρωμένη** | `completed` | ✅ "Παραγγελία Ολοκληρώθηκε! ✅" | Medium |
| **Ακυρωμένη** | `cancelled` | ✅ "Παραγγελία Ακυρώθηκε ❌" | Medium |

---

## 🛠️ **ΠΏΣ ΛΕΙΤΟΥΡΓΕΙ**

### **1. Αλλαγή Κατάστασης από Admin Panel**
Όταν ο admin αλλάζει την κατάσταση παραγγελίας:
```
Status: pending → processing
```

### **2. Αυτόματη Αποστολή Ειδοποίησης**
Το σύστημα αυτόματα:
- ✅ Δημιουργεί push notification
- ✅ Στέλνει στον συγκεκριμένο χρήστη
- ✅ Εμφανίζει στην εφαρμογή του πελάτη
- ✅ Καταγράφει στα logs

---

## 📱 **ΠΑΡΑΔΕΙΓΜΑΤΑ ΕΙΔΟΠΟΙΗΣΕΩΝ**

### **🔄 Σε Επεξεργασία (Processing)**
```
Τίτλος: "Παραγγελία σε Επεξεργασία! 🔄"
Μήνυμα: "Η παραγγελία σας #ORD-20250723-5663 βρίσκεται υπό επεξεργασία. 
         Θα σας ενημερώσουμε όταν είναι έτοιμη!"
```

### **📦 Έτοιμη για Παραλαβή (Ready for Pickup)**  
```
Τίτλος: "Παραγγελία Έτοιμη για Παραλαβή! 📦"
Μήνυμα: "Η παραγγελία σας #ORD-20250723-5663 είναι έτοιμη για παραλαβή 
         από το γυμναστήριο! Σύνολο: €55.80"
```

### **✅ Ολοκληρωμένη (Completed)**
```
Τίτλος: "Παραγγελία Ολοκληρώθηκε! ✅"
Μήνυμα: "Η παραγγελία σας #ORD-20250723-5663 ολοκληρώθηκε επιτυχώς! 
         Ευχαριστούμε για την αγορά σας!"
```

### **❌ Ακυρωμένη (Cancelled)**
```
Τίτλος: "Παραγγελία Ακυρώθηκε ❌"
Μήνυμα: "Η παραγγελία σας #ORD-20250723-5663 ακυρώθηκε. 
         Για περισσότερες πληροφορίες επικοινωνήστε μαζί μας."
```

---

## 🔧 **API ENDPOINT (Admin Panel)**

### **URL:**
```
PUT https://sweat93laravel.obs.com.gr/api/v1/orders/{order_id}/status
```

### **Request:**
```json
{
  "status": "ready_for_pickup"
}
```

### **Response:**
```json
{
  "success": true,
  "order": {
    "id": 1,
    "order_number": "ORD-20250723-5663",
    "status": "ready_for_pickup",
    "total": "55.80",
    ...
  },
  "message": "Η κατάσταση της παραγγελίας ενημερώθηκε και στάλθηκε ειδοποίηση στον πελάτη"
}
```

---

## ⚙️ **ΤΕΧΝΙΚΕΣ ΛΕΠΤΟΜΕΡΕΙΕΣ**

### **Αυτόματη Ενεργοποίηση:**
- ✅ Ενεργοποιείται **αυτόματα** όταν αλλάζει η κατάσταση
- ✅ **Δεν χρειάζεται** επιπλέον ενέργεια από admin
- ✅ **Δεν στέλνει** ειδοποίηση αν η κατάσταση δεν αλλάζει

### **Event System:**
```php
// Αυτόματα dispatch όταν αλλάζει status
OrderStatusChanged::dispatch($order, $oldStatus, $newStatus);

// Listener που στέλνει notification
SendOrderStatusNotification::handle($event);
```

### **Notification Types:**
- **In-App:** Εμφανίζεται στην εφαρμογή
- **Push:** Push notification στο κινητό
- **WebSocket:** Real-time update (αν είναι ενεργό)

---

## 📊 **MONITORING & LOGS**

### **Επιτυχής Αποστολή:**
```
[INFO] Order status notification sent
- order_id: 1
- user_id: 123
- status: ready_for_pickup
- notification_id: 45
```

### **Αποτυχία Αποστολής:**
```
[ERROR] Failed to send order status notification
- order_id: 1
- status: ready_for_pickup
- error: Connection failed
```

### **Παρακολούθηση Ειδοποιήσεων:**
- **Admin Panel:** Πίνακας ειδοποιήσεων
- **Logs:** `/storage/logs/laravel.log`
- **Database:** Πίνακας `notifications` & `notification_recipients`

---

## 🚨 **ΠΡΟΣΟΧΗ - ΣΗΜΑΝΤΙΚΟ**

### **Διπλές Ειδοποιήσεις:**
- ❌ **ΜΗΝ** αλλάζετε την κατάσταση πολλές φορές γρήγορα
- ❌ **ΜΗΝ** κάνετε refresh του status χωρίς λόγο

### **Κατάσταση "pending":**
- ❌ **ΔΕΝ** στέλνει ειδοποίηση (αρχική κατάσταση)
- ✅ Ειδοποίηση στέλνεται όταν αλλάζει σε άλλη κατάσταση

### **Υπεύθυνη Χρήση:**
- ✅ Αλλάξτε την κατάσταση **μόνο όταν είναι έτοιμη**
- ✅ Χρησιμοποιήστε **"ready_for_pickup"** όταν ο πελάτης μπορεί να έρθει
- ✅ Χρησιμοποιήστε **"completed"** όταν παραλάβει ο πελάτης

---

## 🎯 **WORKFLOW ΣΥΣΤΑΣΕΙΣ**

### **Βήμα 1: Παραγγελία Εισήλθε**
```
Status: pending (χωρίς ειδοποίηση)
```

### **Βήμα 2: Αρχίστε την Προετοιμασία**
```
Admin: Αλλάζει σε "processing"
→ Πελάτης λαμβάνει: "Παραγγελία σε Επεξεργασία! 🔄"
```

### **Βήμα 3: Παραγγελία Έτοιμη**
```
Admin: Αλλάζει σε "ready_for_pickup"  
→ Πελάτης λαμβάνει: "Παραγγελία Έτοιμη για Παραλαβή! 📦"
```

### **Βήμα 4: Πελάτης Παρέλαβε**
```
Admin: Αλλάζει σε "completed"
→ Πελάτης λαμβάνει: "Παραγγελία Ολοκληρώθηκε! ✅"
```

---

## 🔧 **TROUBLESHOOTING**

### **Ειδοποίηση δεν στάλθηκε:**
1. ✅ Ελέγξτε αν άλλαξε πραγματικά η κατάσταση
2. ✅ Ελέγξτε τα logs για σφάλματα
3. ✅ Βεβαιωθείτε ότι ο χρήστης έχει έγκυρο ID
4. ✅ Ελέγξτε αν το WebSocket server τρέχει

### **Διπλές ειδοποιήσεις:**
1. ❌ Μη αλλάζετε την κατάσταση γρήγορα
2. ❌ Μη κάνετε refresh χωρίς αιτία
3. ✅ Περιμένετε λίγα δευτερόλεπτα μεταξύ αλλαγών

---

## ✅ **DEPLOYMENT STATUS**
**🚀 ΕΝΕΡΓΟ & ΛΕΙΤΟΥΡΓΙΚΟ**

Το σύστημα ειδοποιήσεων παραγγελιών είναι πλήρως ενεργό και έτοιμο για χρήση!

---

*Αυτός ο οδηγός βοηθά τους admins να κατανοήσουν πώς λειτουργεί το σύστημα ειδοποιήσεων και πώς να το χρησιμοποιήσουν αποτελεσματικά.* 